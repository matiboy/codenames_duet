{% extends 'vue_base.html' %}
{% block style %}
{{super()}}

  <style>
    .theme--dark.v-card > .v-card__text {
      font-size: 1.3em;
      text-transform: uppercase;
      padding-top: 40px;
      padding-bottom: 40px;
      border: 2px solid white;
    }
    .attempted-wrapper {
      position: absolute;
      top: 2px;
      right: 5px;
    }
    img.dead {
      filter: grayscale(1) blur(3px);
    }
    h1 {
      font-size: 5em;
    }
    .found {
      filter: drop-shadow(0 0 10px green) drop-shadow(0 0 10px green)
    }
    .good {
      background-color: green;
      color: white;
    }
    .assassin {
      background-color: black;
      border-color: cornsilk;
      color: white;
    }
    td {
      background-color: white;
      border: solid 1px black;
      text-align: center;
      padding: 10px 0;
      width: 20%;
    }
    table#key {
      border: solid 2px cornsilk !important;
      width: 100%;
      border-collapse:collapse;
      font-family: Arial, Helvetica, sans-serif;
    }
    #video-other-player {
      background-color: red;
      width: 200px;
      height: 160px;
    }
    video#video-0, video#video-16, video#video-preview {
      width: 100%;
    }
  </style>
{% endblock %}
{% block vuetemplate %}
<v-container fluid>
    <audio id="meeting-audio" style="display:none"></audio>
    <!-- <v-row>
      <video id="video-preview"></video>
      <video id="video-other-player"></video>
    </v-row> -->
    <v-row>
      <v-col cols="2">
        <table id="key" border="0">
          {% for row in words %}
          <tr>
            {% for word in row %}<td {% if word in player.green %}class="good"{% elif word in player.black %}class="assassin"{%endif%}></td>{%endfor%}
          </tr>
          {% endfor %}
        </table>
        <p v-if="playerStatus !== 'open'">You are now <span class="status" v-text="playerStatusText"></span></p>
        <div id="flow-load-devices" class="flow" v-show="videoStep === 'flow-load-devices'">
          <v-progress-circular indeterminate></v-progress-circular>
          <small>Reading your microphone and camera details</small>
        </div>
        <div id="flow-devices" class="flow" v-show="videoStep === 'flow-in-meeting'">
          <div id="tile-0">
            <video id="video-0"></video>
            <v-row>
              <v-col class="nameplate">{{thisPlayerName}}</v-col>
              <v-col>
                <v-btn icon @click="pauseSelf"><v-icon>mdi-pause</v-icon></v-btn>
              </v-col>
            </v-row>
          </div>
          <div id="tile-16">
            <video id="video-16"></video>
            <div id="nameplate-16">{{otherPlayerName}}</div>
            <v-btn id="video-pause-16" icon><v-icon>mdi-pause</v-icon></button>
            <v-btn id="video-resume-16" icon><v-icon>mdi-play</v-icon></button>
          </div>
        </div>
        <div id="flow-devices" class="flow" v-show="videoStep === 'flow-devices'">
          <div class="container">
            <form id="form-devices">
              <p class="text-center">Select devices</p>
              <v-col>
                <v-row>
                  <v-select :value="selectedAudioInput" @input="selectAudioInput" id="audio-input" label="Microphone" :items="audioInputDevices"></v-select>
                </v-row>
                <!-- <v-col>
                  <h4>Preview</h4>
                  <v-row class="w-100 progress" style="margin-top:0.75rem">
                    <div id="audio-preview" class="progress-bar bg-success" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                  </v-row>
                </v-col> -->
                <v-row>
                  <v-select :value="selectedVideoInput" @input="selectVideoInput" id="video-input" label="Camera" :items="videoInputDevices"></v-select>
                </v-row>
                <v-row>
                  <video id="video-preview"></video>
                </v-row>
                <v-row>
                  <v-select :value="selectedVideoQuality" id="video-input-quality" @input="selectVideoQuality" label="Quality" :items="qualityOptions"></v-select>
                </v-row>
                <v-row>
                  <v-select :value="selectedAudioOutput" id="audio-output" label="Speaker" @input="selectAudioOutput" :items="audioOutputDevices"></v-select>
                </v-row>
                <v-row>
                  <v-btn @click="testSpeaker" small outlined color="info">Test <v-icon>mdi-speaker</v-icon></v-btn>
                </v-row>
                <v-row class="mt-3">
                  <v-btn @click="join" color="success">Join</v-btn>
                </v-row>
              </v-col>
            </form>
            <div id="progress-join" class="w-100 progress progress-hidden">
              <div class="w-100 progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
          </div>
        </div>
    
      </v-col>
      <v-col cols="9">
        <v-row v-for="row, i in rows" :key="i">
          <v-col cols="1"></v-col>
          <v-col cols="2" v-for="word, j in row" :key="j">
            <v-card @click="pointed(word)" :class="{found: isFound(word)}">
              <v-card-text class="text-center">
                <div class="attempted-wrapper">
                  <v-icon v-if="player1Attempted(word)">mdi-numeric-1-circle</v-icon>
                  <v-icon v-if="player2Attempted(word)">mdi-numeric-2-circle</v-icon>
                </div>
                <div v-text="word"></div>
              </v-card-text>
            </v-card>
          </v-col>
          <v-col cols="1"></v-col>
        </v-row>
      </v-col>
      <v-col cols="1">
        <v-col align="center" justify="center">
          <small>Innocent Bystanders</small><br>
          <img v-for="img, i in bystanders" :key="img" :src="img" :class="{dead: i >= game.bystanders}" class="ml-1 mr-1">
        </v-col>
      </v-col>
    </v-row>
    <v-col>
      <v-row align="center" justify="center" v-if="!noPlayer">
        <v-col cols="auto">
          <span v-text="nextPlayer.name"></span>'s turn to GUESS
        </v-col>
        <v-col cols="1"></v-col>
        <v-col cols="2">
          <v-btn color="warning" outlined @click="stopGuessing"><v-icon>mdi-stop</v-icon> Stop guessing</v-btn>
        </v-col>
      </v-row>
      <v-row align="center" justify="center" v-if="noPlayer">
        Anyone can start with the first hint.
      </v-row>
    </v-col>
  </v-container>
  <v-overlay :value="ended" :color="overlayColor">
    <span v-text="won"></span>
    <span v-text="lost"></span>
    <h1 class="success--text" v-if="won">Win!</h1>
    <h1 class="error--text" v-if="lost">LOST ðŸ˜“</h1>
    <v-btn large @click="startNew">Start new game</v-btn>
  </v-overlay>
</v-content>
{% endblock %}
{% block vueapp %}
<script src="/static/game_split.js"></script>
<script src="/dynamic/{{attendee.ExternalUserId}}.js"></script>
<script>
  // Avoid mistakenly using game vs this.game
  window.GAME = {{game|tojson|safe}}
  window.MEETING = {{meeting|tojson|safe}}
  window.ATTENDEE = {{attendee|tojson|safe}}
  window.playerNumber = {{player_number}}
  window.PUSHER_KEY = '{{pusher_key}}'
  window.PUSHER_CLUSTER = '{{pusher_cluster}}'
  
  window.$vm = new Vue({
    ...CovidNames.game_split.default,
    data: {
      ...CovidNames.game_split.default.data,
      game: window.GAME
    },
    el: '#app',
    vuetify: new Vuetify({
      theme: {
        dark: true
      }
    })
  })
</script>
{% endblock %}